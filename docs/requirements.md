# 要件定義書: 不動産訪問アンケート

## 1. 目的
- 不動産訪問後の顧客満足度と改善点を把握する
- 担当者対応の品質を可視化する
- 低コストで継続的に運用できるアンケート基盤を提供する

## 2. 前提
- 対象ユーザ: 不動産の顧客（回答者）、不動産担当者（配信・結果閲覧）
- アンケートは単発運用（複数同時運用は対象外）
- 顧客へメールでアンケートURLを送信する
- 実装言語はTypeScript
- Cloudflareの無料枠で運用する

## 3. スコープ
### 3.1 スコープ内
- アンケート回答フォームの提供
- 顧客リスト登録とメール配信
- 回答データの保存と集計表示
- 配信ログ/回答状況の可視化
- CSVエクスポート
- 管理画面の最小限の認証

### 3.2 スコープ外
- 複数アンケートの同時運用
- 会員登録/ポイント付与などのCRM機能
- 予約/契約など他業務の自動化
- 画像/ファイル添付

## 4. ユーザと権限
- 顧客: メールURLから回答、ログイン不要
- 担当者: 配信、回答状況の確認、集計閲覧
- 管理者: 設問管理、ユーザ権限管理、ログ閲覧

## 5. 機能要件
### 5.1 配信
- 顧客メール一覧の登録（CSV取込/手入力）
- メールテンプレート編集（件名/本文/差し込み）
- ユニークURLの発行と期限設定
- 配信状態の記録（送信済み/失敗/再送）
- 送信元の名称/署名の設定

### 5.2 回答
- レスポンシブな回答フォーム表示
- 入力バリデーションと必須チェック
- 回答送信と完了画面表示
- トークンURLの一回利用制限
- 期限切れ時の案内表示

### 5.3 結果管理
- 回答一覧の検索と期間フィルタ
- 個別回答の詳細表示
- 集計表示（平均/分布/自由記述）
- 担当者別の集計
- CSV出力（回答/配信）
- 回答の削除/匿名化（管理者）

## 6. 非機能要件
- 性能: 通常ページ表示は3秒以内を目標
- 可用性: Cloudflareの冗長構成に依存
- 対応端末: PC/スマホ主要ブラウザ
- 多言語: 日本語のみ
- セキュリティ: HTTPS必須、トークンURLに推測耐性
- 監査: 管理操作ログを保存

## 7. データ要件
- 顧客情報: 氏名、メール、訪問日時（最小限）
- 送信情報: トークン、送信日時、期限、状態
- 設問情報: 質問文、形式、必須フラグ
- 回答情報: 回答JSON、作成日時、参照トークン
- 操作ログ: ユーザID、操作内容、日時、IP

## 8. アーキテクチャ
- フロントエンド: Cloudflare Pages（TypeScript）
- API: Cloudflare Workers
- DB: Cloudflare D1
- トークン管理: D1またはKV
- 監視: Cloudflare Analytics/ログ

## 9. 外部サービス
- メール送信: Resend/SendGrid等のAPI
- ドメイン/DNS: Cloudflare管理

## 10. 運用
- 送信フロー: リスト作成→配信→回収→集計
- バックアップ: D1の定期エクスポート
- 送信失敗: 再送と手動対応手順
- 設問変更: 配信前のみ変更可

## 11. 設問（キャプチャ準拠）
- 名前（必須、テキスト、姓/名）
- 名前（フリガナ）（必須、テキスト、セイ/メイ）
- 住所（必須、郵便番号/都道府県/市区町村/番地/建物名・部屋番号）
- 電話（必須、テキスト）
- メールアドレス（任意、テキスト）
- 性別（任意、単一選択: 男性/女性/その他/無回答）
- ご職業（必須、単一選択: 会社員/会社役員/公務員/自営業/主夫/主婦/アルバイト/学生/その他）
- 業種（必須、単一選択、プルダウン）
- 現在のお困り事について、当てはまるもの（必須、複数選択: 住宅ローン/無担保ローン/相続/離婚/その他）
- 物件種別（必須、複数選択: 土地/戸建/マンション）
- 敷地（必須、数値、単位: ㎡）
- 築年数（必須、単一選択、プルダウン）
- ローン残債（必須、数値、単位: 万円）
- 債務状況（必須、単一選択: 滞納無し/滞納中/競売開始決定済み）
- 滞納期間（任意、単一選択、プルダウン。滞納中の方が対象: 1ヶ月/2ヶ月/3ヶ月/4ヶ月/5ヶ月/6ヶ月/7ヶ月以上）
- その他、ご質問・ご相談事項（任意、テキストエリア）

## 12. 未確定項目
- プルダウン選択肢の詳細（業種/築年数）
- 回答期限の標準値
- 管理画面の認証方式
- データ保存期間と削除方針
- メール送信サービスの選定
